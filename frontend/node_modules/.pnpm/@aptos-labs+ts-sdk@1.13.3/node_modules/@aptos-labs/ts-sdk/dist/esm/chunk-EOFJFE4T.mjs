import{a as $,c as an,d as rn,e as U}from"./chunk-YU3KB3UV.mjs";import{q as en,t as y}from"./chunk-RIUZPGI5.mjs";import{a as m}from"./chunk-VVIG4E7Q.mjs";import{a as nn}from"./chunk-AU6W5OIH.mjs";import{a as tn}from"./chunk-CU67XZNB.mjs";import{a as W,c as l,d as T}from"./chunk-PZGLV5UQ.mjs";import{c as z,d as Z,e as j,f as N,g as J,h as Q,i as Y}from"./chunk-DM44OGQH.mjs";import{a as X}from"./chunk-BWFJHFBQ.mjs";import{b as E,d as F,e as R,f as D}from"./chunk-G2O323HP.mjs";import{a as H}from"./chunk-IIPYR7PF.mjs";import{a as V,b as g,d as p}from"./chunk-SUAKPNKQ.mjs";import{a as v,b as B}from"./chunk-V4SRNEV3.mjs";import{a as b,c as x}from"./chunk-CNMQNPNV.mjs";import{a as k,c as O}from"./chunk-O4JRPZZM.mjs";import{b as u}from"./chunk-IOSQVDZI.mjs";import{b as L}from"./chunk-7QJ6YJXP.mjs";import{a as K}from"./chunk-AH44UPM4.mjs";import{a as q}from"./chunk-W4ZW7QHA.mjs";import{a as G}from"./chunk-ROXFCLDT.mjs";import{b as S}from"./chunk-AOCNYMMX.mjs";import{e as I}from"./chunk-XDGQTMDV.mjs";import{b as _,c as M,f as C,g as P}from"./chunk-CYNQRMO5.mjs";import{sha3_256 as on}from"@noble/hashes/sha3";async function Kn(n){if(en(n))return fn(n);let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),a=await cn({key:"entry-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:an});return mn({...n,abi:a})}function mn(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:a}=y(n.function),r=$(n.typeArguments);if(r.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${r.length}`);let o=n.functionArguments.map((s,d)=>U(n.function,t,s,d,r));if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${a}', expected ${t.parameters.length} but got ${o.length}`);let c=N.build(`${e}::${i}`,a,r,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new j(new Q(s,new Y(c)))}return new Z(c)}async function Hn(n){let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),a=await cn({key:"view-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:rn});return yn({abi:a,...n})}function yn(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:a}=y(n.function),r=$(n.typeArguments);if(r.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${r.length}`);let o=n?.functionArguments?.map((c,s)=>U(n.function,t,c,s,r))??[];if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${a}', expected ${t.parameters.length} but got ${o.length}`);return N.build(`${e}::${i}`,a,r,o)}function fn(n){return new z(new J(S.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function gn(n){let{aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r}=n,o=async()=>I[t.network]?{chainId:I[t.network]}:{chainId:(await q({aptosConfig:t})).chain_id},c=async()=>a?.gasUnitPrice?{gasEstimate:a.gasUnitPrice}:{gasEstimate:(await L({aptosConfig:t})).gas_estimate},s=async()=>{let f=async()=>a?.accountSequenceNumber!==void 0?a.accountSequenceNumber:(await H({aptosConfig:t,accountAddress:e})).sequence_number;if(r&&u.from(r).equals(u.ZERO))try{return await f()}catch{return 0}else return f()},[{chainId:d},{gasEstimate:A},h]=await Promise.all([o(),c(),s()]),{maxGasAmount:un,gasUnitPrice:dn,expireTimestamp:An}={maxGasAmount:a?.maxGasAmount?BigInt(a.maxGasAmount):BigInt(2e5),gasUnitPrice:a?.gasUnitPrice??BigInt(A),expireTimestamp:a?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new W(u.from(e),BigInt(h),i,BigInt(un),BigInt(dn),BigInt(An),new X(d))}async function Ln(n){let{aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r}=n,o=await gn({aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new tn(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new nn(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Xn(n){let{signerPublicKey:t,transaction:e,secondarySignersPublicKeys:i,feePayerPublicKey:a}=n,r=w(t);if(e.feePayerAddress){let c=new T(e.rawTransaction,e.secondarySignerAddresses??[],e.feePayerAddress),s=[];i&&(s=i.map(h=>w(h)));let d=w(a),A=new R(r,e.secondarySignerAddresses??[],s,{address:e.feePayerAddress,authenticator:d});return new m(c.raw_txn,A).bcsToBytes()}if(e.secondarySignerAddresses){let c=new l(e.rawTransaction,e.secondarySignerAddresses),s=[];s=i.map(A=>w(A));let d=new F(r,e.secondarySignerAddresses,s);return new m(c.raw_txn,d).bcsToBytes()}let o;if(r instanceof g)o=new E(r.public_key,r.signature);else if(r instanceof p)o=new D(r);else throw new Error("Invalid public key");return new m(e.rawTransaction,o).bcsToBytes()}function w(n){if(n instanceof v){if(n.publicKey instanceof b)return new p(n,new B(new x(new Uint8Array(64))));if(n.publicKey instanceof k)return new p(n,new B(new O(new Uint8Array(64))))}return new g(new b(n.toUint8Array()),new x(new Uint8Array(64)))}function zn(n){let{signer:t,transaction:e}=n,i=wn(e);return t.signWithAuthenticator(i)}function pn(n){let{transaction:t,feePayerAuthenticator:e,additionalSignersAuthenticators:i}=n,a=G(V,n.senderAuthenticator),r;if(t.feePayerAddress){if(!e)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");r=new R(a,t.secondarySignerAddresses??[],i??[],{address:t.feePayerAddress,authenticator:e})}else if(t.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");r=new F(a,t.secondarySignerAddresses,i)}else a instanceof g?r=new E(a.public_key,a.signature):r=new D(a);return new m(t.rawTransaction,r).bcsToBytes()}function sn(n){let t=on.create();for(let e of n)t.update(e);return t.digest()}var ln=sn(["APTOS::Transaction"]);function Zn(n){let t=pn(n);return new S(sn([ln,new Uint8Array([0]),t])).toString()}function Tn(n){return n.feePayerAddress?new T(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new l(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function wn(n){let t=Tn(n),e=on.create();if(t instanceof W)e.update(C);else if(t instanceof l)e.update(P);else if(t instanceof T)e.update(P);else throw new Error(`Unknown transaction type to sign on: ${t}`);let i=e.digest(),a=t.bcsToBytes(),r=new Uint8Array(i.length+a.length);return r.set(i),r.set(a,i.length),r}async function cn({key:n,moduleAddress:t,moduleName:e,functionName:i,aptosConfig:a,abi:r,fetch:o}){return r!==void 0?r:K(async()=>o(t,e,i,a),`${n}-${a.network}-${t}-${e}-${i}`,1e3*60*5)()}export{Kn as a,mn as b,Hn as c,yn as d,gn as e,Ln as f,Xn as g,w as h,zn as i,pn as j,sn as k,Zn as l,Tn as m,wn as n};
//# sourceMappingURL=chunk-EOFJFE4T.mjs.map